---------------------------------
CREATE TABLE CAR(
CAR_VIN INTEGER,
CAR_MAKE VARCHAR2(30),
CAR_MODEL VARCHAR2(30),
CAR_YEAR INTEGER,
CAR_OWNER VARCHAR2(30),
CAR_STATUS VARCHAR2(30) DEFAULT 'AVAILABLE');

CREATE TABLE CUSTOMER(
CUSTOMER_USERNAME VARCHAR2(50) PRIMARY KEY,
CUSTOMER_PASSWORD VARCHAR2(50));

 
CREATE TABLE EMPLOYEE(
EMPLOYEE_USERNAME VARCHAR2(50),
EMPLOYEE_PASSWORD VARCHAR2 (50));

CREATE TABLE OFFER(
OFFER_ID INTEGER PRIMARY KEY,
CUSTOMER_USERNAME VARCHAR2(50),
CAR_VIN INTEGER,
OFFER_MONTHLY_PAYMENT NUMBER(*,2),
OFFER_AMOUNT NUMBER(*,2),
OFFER_PAYMENTS_LEFT NUMBER,
OFFER_STATUS VARCHAR2(50));

--CONSTRAINTS---------------------------
ALTER TABLE OFFER
ADD CONSTRAINT FK_OFFER_CUSTOMER
FOREIGN KEY (CUSTOMER_USERNAME) REFERENCES CUSTOMER(CUSTOMER_USERNAME);

ALTER TABLE OFFER
ADD CONSTRAINT FK_OFFER_CAR
FOREIGN KEY (CAR_VIN) REFERENCES CAR(CAR_VIN);
ALTER TABLE OFFER
DROP CONSTRAINT FK_OFFER_CUSTOMER;

CREATE SEQUENCE MYSEQ;
CREATE SEQUENCE MYSEQ2;
UPDATE OFFER SET OFFER_ID = MYSEQ.NEXTVAL;
UPDATE OFFER SET CAR_VIN = MYSEQ2.NEXTVAL;

--PROCEDURE----------------------
CREATE OR REPLACE PROCEDURE NEWCARACCEPTED
(USERNAYME IN VARCHAR2, CARID IN INTEGER)
AS
BEGIN
UPDATE CAR SET CAR_OWNER = USERNAYME WHERE CAR_VIN = CARID;
UPDATE CAR SET CAR_STATUS = 'Unavailable' WHERE CAR_VIN = CARID;
UPDATE OFFER SET OFFER_STATUS = 'Accepted' WHERE CUSTOMER_USERNAME = USERNAYME AND CAR_VIN = CARID;
UPDATE OFFER SET OFFER_PAYMENTS_LEFT = 12;
UPDATE OFFER SET OFFER_MONTHLY_PAYMENT = OFFER_AMOUNT / OFFER_PAYMENTS_LEFT;
DELETE FROM OFFER WHERE CAR_VIN = CARID AND CUSTOMER_USERNAME != USERNAYME;
COMMIT;
END;
/